{% extends "base.html" %}
{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é{% endblock %}

{% block content %}
<div class="card mx-auto" style="max-width: 600px;">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h5>
  </div>
  <div class="card-body">
    <form method="post">
      <div class="form-group">
        <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
        <input
          type="text"
          id="name"
          name="name"
          class="form-control"
          value="{{ category.name }}"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ"
          required
          maxlength="100"
          autofocus
        >
      </div>
      <div class="form-group">
        <label for="parent_id">–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select
          id="parent_id"
          name="parent_id"
          class="form-control select2"
        >
          <option value="0" {% if not category.parent_id %}selected{% endif %}>
            ‚Äî –ë–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî
          </option>
          {% for cat, lvl in tree %}
            {% if cat.id != category.id %}
              <option
                value="{{ cat.id }}"
                data-level="{{ lvl }}"
                {% if category.parent_id == cat.id %}selected{% endif %}
              >
                {{ "  " * lvl }}üìÅ {{ cat.name }}
              </option>
            {% endif %}
          {% endfor %}
        </select>
        <small class="form-text text-muted">
          –í—ã–±–µ—Ä–∏—Ç–µ ¬´–ë–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏¬ª, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è.
        </small>
      </div>
      <div class="d-flex justify-content-between">
        <a href="{{ url_for('categories_view') }}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    $(document).ready(() => {
      $('#parent_id').select2({
        width: '100%',
        templateResult: function(opt) {
          if (!opt.id) return opt.text;
          const lvl = $(opt.element).data('level') || 0;
          const prefix = '¬†¬†'.repeat(lvl);
          return $('<span>' + prefix + (lvl ? 'üìÑ ' : 'üìÅ ') + opt.text + '</span>');
        },
        templateSelection: function(opt) {
          if (!opt.id) return opt.text;
          const lvl = $(opt.element).data('level') || 0;
          const prefix = '¬†¬†'.repeat(lvl);
          return $('<span>' + prefix + (lvl ? 'üìÑ ' : 'üìÅ ') + opt.text + '</span>');
        },
        escapeMarkup: m => m
      });
      $('#name').focus();
    });
  </script>
{% endblock %}

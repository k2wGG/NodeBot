{% extends "base.html" %}
{% block title %}–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç{% endblock %}

{% block content %}
<div class="container">
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-success text-white">
      –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç
    </div>
    <div class="card-body">
      <form method="post" action="{{ url_for('add_post') }}" autocomplete="off">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="form-group">
          <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
          <input
            type="text"
            class="form-control"
            id="title"
            name="title"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞"
            required
            maxlength="150"
            autofocus
            aria-label="–ó–∞–≥–æ–ª–æ–≤–æ–∫"
          >
          <small class="form-text text-muted">
            –ú–∞–∫—Å–∏–º—É–º 150 —Å–∏–º–≤–æ–ª–æ–≤.
          </small>
        </div>

        <!-- –°—Å—ã–ª–∫–∞ -->
        <div class="form-group">
          <label for="link">–°—Å—ã–ª–∫–∞</label>
          <input
            type="url"
            class="form-control"
            id="link"
            name="link"
            pattern="https://.*"
            maxlength="255"
            placeholder="https://t.me/–≤–∞—à_–∫–∞–Ω–∞–ª/123"
            required
            aria-label="–°—Å—ã–ª–∫–∞"
          >
          <small class="form-text text-muted">
            –¢–æ–ª—å–∫–æ Telegram-—Å—Å—ã–ª–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å <code>https://</code>
          </small>
        </div>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div class="form-group">
          <label for="category_id">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select
            class="form-control select2"
            id="category_id"
            name="category_id"
            required
            aria-label="–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
          >
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>
            {% for cat, lvl in tree %}
              <option
                value="{{ cat.id }}"
                data-level="{{ lvl }}"
              >
                {{ '  ' * lvl }}{% if lvl==0 %}üìÅ{% else %}üìÑ{% endif %} {{ cat.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
        <div class="form-group">
          <label for="start_date">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</label>
          <input
            type="date"
            class="form-control"
            id="start_date"
            name="start_date"
            aria-label="–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞"
          >
          <small class="form-text text-muted">
            –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º ‚Äî –ø–æ—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è —Å—Ä–∞–∑—É.
          </small>
        </div>

        <!-- –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
        <div class="form-group">
          <label for="end_date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</label>
          <input
            type="date"
            class="form-control"
            id="end_date"
            name="end_date"
            aria-label="–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è"
          >
          <small class="form-text text-muted">
            –ü–æ—Å–ª–µ —ç—Ç–æ–π –¥–∞—Ç—ã –ø–æ—Å—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –∞—Ä—Ö–∏–≤.
          </small>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <button type="submit" class="btn btn-success">
          <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç
        </button>
        <a href="{{ url_for('posts_view') }}" class="btn btn-secondary">
          –û—Ç–º–µ–Ω–∞
        </a>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è select2 + –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç -->
  <script>
    $(function(){
      $('#category_id').select2();

      // –ß—Ç–æ–±—ã –Ω–µ–ª—å–∑—è –±—ã–ª–æ –≤—ã–±—Ä–∞—Ç—å end_date —Ä–∞–Ω—å—à–µ start_date
      $('#start_date, #end_date').on('change', function(){
        let start = $('#start_date').val();
        let end = $('#end_date').val();
        if (start && end && end < start) {
          $('#end_date')[0].setCustomValidity('–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞');
        } else {
          $('#end_date')[0].setCustomValidity('');
        }
      });
    });
  </script>
{% endblock %}

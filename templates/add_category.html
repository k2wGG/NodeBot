{% extends "base.html" %}
{% block title %}–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é{% endblock %}

{% block content %}
<div class="card mx-auto" style="max-width: 600px;">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h5>
  </div>
  <div class="card-body">
    {% if error %}
      <div class="alert alert-danger" role="alert">{{ error }}</div>
    {% endif %}
    <form method="post" autocomplete="off">
      <div class="form-group">
        <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
        <input
          type="text"
          id="name"
          name="name"
          class="form-control"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ"
          required
          minlength="2"
          maxlength="100"
          autofocus
          aria-label="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
        >
      </div>
      <div class="form-group">
        <label for="parent_id">–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select
          id="parent_id"
          name="parent_id"
          class="form-control select2"
          aria-label="–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"
        >
          <option value="0">‚Äî –ë–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî</option>
          {% for cat, lvl in tree %}
            <option
              value="{{ cat.id }}"
              data-level="{{ lvl }}"
            >{{ "¬†¬†" * lvl }}üìÅ {{ cat.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="d-flex justify-content-between">
        <a href="{{ url_for('categories_view') }}" class="btn btn-secondary">
          –û—Ç–º–µ–Ω–∞
        </a>
        <button type="submit" class="btn btn-success">
          –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Select2 —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ –ø–æ —É—Ä–æ–≤–Ω—é –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
    function formatCat(opt) {
      if (!opt.id) return opt.text;
      const lvl = $(opt.element).data('level') || 0;
      const prefix = '&nbsp;&nbsp;'.repeat(lvl);
      return $('<span>' + prefix + (lvl ? 'üìÑ ' : 'üìÅ ') + opt.text + '</span>');
    }
    $(document).ready(() => {
      $('#parent_id').select2({
        width: '100%',
        templateResult: formatCat,
        templateSelection: formatCat,
        escapeMarkup: m => m,
        placeholder: "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é"
      });
      // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–º –ø–æ–ª–µ
      $('#name').focus();
    });
  </script>
{% endblock %}

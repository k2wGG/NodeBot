{% extends "base.html" %}
{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç ‚Ññ{{ post.id }}{% endblock %}

{% block content %}
<div class="container">
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-success text-white">
      –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç
    </div>
    <div class="card-body">
      <form method="post" id="editPostForm" action="{{ url_for('edit_post', post_id=post.id) }}">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="form-group">
          <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
          <input
            type="text"
            class="form-control"
            id="title"
            name="title"
            value="{{ post.title }}"
            required
            autocomplete="off"
          >
        </div>

        <!-- –°—Å—ã–ª–∫–∞ -->
        <div class="form-group">
          <label for="link">–°—Å—ã–ª–∫–∞</label>
          <input
            type="url"
            class="form-control"
            id="link"
            name="link"
            value="{{ post.link }}"
            required
            autocomplete="off"
            placeholder="https://t.me/..."
          >
        </div>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div class="form-group">
          <label for="category_id">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select
            class="form-control select2"
            id="category_id"
            name="category_id"
            required
          >
            <option></option>
            {% for cat, lvl in tree %}
              <option
                value="{{ cat.id }}"
                data-level="{{ lvl }}"
                {% if cat.id == post.category_id %}selected{% endif %}
              >
                {{ '  ' * lvl }}{% if lvl==0 %}üìÅ{% else %}üìÑ{% endif %} {{ cat.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
        <div class="form-group">
          <label for="start_date">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</label>
          <input
            type="date"
            class="form-control"
            id="start_date"
            name="start_date"
            value="{{ post.start_date.isoformat() if post.start_date }}"
          >
          <small class="form-text text-muted">
            –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º ‚Äî –ø—É–±–ª–∏–∫—É–µ–º —Å—Ä–∞–∑—É.
          </small>
        </div>

        <!-- –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
        <div class="form-group">
          <label for="end_date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</label>
          <input
            type="date"
            class="form-control"
            id="end_date"
            name="end_date"
            value="{{ post.end_date.isoformat() if post.end_date }}"
          >
          <small class="form-text text-muted">
            –ü–æ—Å–ª–µ —ç—Ç–æ–π –¥–∞—Ç—ã –ø–æ—Å—Ç —É–π–¥—ë—Ç –≤ –∞—Ä—Ö–∏–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
          </small>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <button type="submit" class="btn btn-success">
          <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
        </button>
        <a href="{{ url_for('posts_view') }}" class="btn btn-secondary">
          –û—Ç–º–µ–Ω–∞
        </a>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è select2 + JS-–≤–∞–ª–∏–¥–∞—Ü–∏—è -->
  <script>
    $(function(){
      $('#category_id').select2();

      $('#editPostForm').on('submit', function() {
        var sd = $('#start_date').val();
        var ed = $('#end_date').val();
        if (sd && ed && ed < sd) {
          alert('–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞!');
          return false;
        }
        $(this).find('button[type="submit"]').prop('disabled', true);
      });
    });
  </script>
{% endblock %}

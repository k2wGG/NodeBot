{# templates/available_discord_channels.html #}
{% extends 'base.html' %}

{% block title %}–î–æ—Å—Ç—É–ø–Ω—ã–µ Discord-–∫–∞–Ω–∞–ª—ã{% endblock %}

{% block content %}
  <div class="container mt-4">
    <h1>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö Discord-–∫–∞–Ω–∞–ª–æ–≤</h1>

    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å: –∫–Ω–æ–ø–∫–∞ –î–æ–±–∞–≤–∏—Ç—å –∏ –∫–Ω–æ–ø–∫–∞ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ -->
    <div class="mb-3">
      <a href="{{ url_for('add_available_discord_channel') }}" class="btn btn-primary">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª
      </a>
      <!-- –ö–Ω–æ–ø–∫–∞ –º–∞—Å—Å–æ–≤–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –Ω–∞ /available_discord_channels -->
      <button type="submit" form="bulkForm" class="btn btn-success ml-2">
        ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
      </button>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: –≤—Å—è —Ç–∞–±–ª–∏—Ü–∞ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π —Ñ–æ—Ä–º—ã -->
    <form id="bulkForm" method="post" action="{{ url_for('available_discord_channels_view') }}">
      <table class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th scope="col">
              <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤: –º–µ—Ç–∫–∞ / –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å ¬´–≤—ã–±—Ä–∞—Ç—å –≤—Å–µ¬ª —á–µ—Ä–µ–∑ JS -->
              <input type="checkbox" id="select-all" />
            </th>
            <th scope="col">ID</th>
            <th scope="col">–ò–º—è –∫–∞–Ω–∞–ª–∞</th>
            <th scope="col">Discord ID</th>
            <th scope="col">Last Seen</th>
            <th scope="col">–ê–∫—Ç–∏–≤–µ–Ω?</th>
            <th scope="col">–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% for ch in channels %}
            <tr {% if not ch.is_active %}class="table-secondary"{% endif %}>
              <td>
                <input type="checkbox" name="selected_ids" value="{{ ch.id }}"
                       {% if ch.is_active %}checked disabled{% endif %} />
              </td>
              <td>{{ ch.id }}</td>
              <td>{{ ch.channel_name }}</td>
              <td>{{ ch.channel_id }}</td>
              <td>{{ ch.last_seen.strftime('%Y-%m-%d %H:%M') }}</td>
              <td>
                {% if ch.is_active %}
                  <span class="badge badge-success">–î–∞</span>
                {% else %}
                  <span class="badge badge-danger">–ù–µ—Ç</span>
                {% endif %}
              </td>
              <td>
                <a href="{{ url_for('edit_available_discord_channel', adc_id=ch.id) }}"
                   class="btn btn-sm btn-warning">
                  ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </a>
                <form action="{{ url_for('delete_available_discord_channel', adc_id=ch.id) }}"
                      method="post"
                      style="display:inline-block; margin-left: 5px;"
                      onsubmit='return confirm("–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª ¬´{{ ch.channel_name }}¬ª?");'>
                  <button type="submit" class="btn btn-sm btn-danger">
                    üóë –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                  </button>
                </form>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="7" class="text-center">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </form>
  </div>
{% endblock %}

{% block scripts %}
  <script>
    // ‚Äú–í—ã–±—Ä–∞—Ç—å –≤—Å–µ / –°–Ω—è—Ç—å –≤—Å–µ‚Äù –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ #select-all
    document.addEventListener('DOMContentLoaded', function() {
      const selectAllToggle = document.getElementById('select-all');
      if (!selectAllToggle) return;

      selectAllToggle.addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('input[name="selected_ids"]');
        checkboxes.forEach(ch => {
          // –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã —É–∂–µ disabled, –º—ã –Ω–µ —Ç—Ä–æ–≥–∞–µ–º –∏—Ö
          if (!ch.disabled) {
            ch.checked = selectAllToggle.checked;
          }
        });
      });
    });
  </script>
{% endblock %}
